<!-- Technical Chart Tab (Visible by default) -->
<div
  id="tab-content-chart"
  class="h-full w-full flex flex-col tab-content-item px-4 pt-4 pb-4 lg:px-8 lg:pb-8 overflow-hidden z-10"
>
  <div
    id="chart-tab-content-empty"
    class="flex-1 bg-white/20 dark:bg-slate-900/20 rounded-3xl border border-slate-400 dark:border-white/20 backdrop-blur-sm flex flex-col items-center justify-center p-8 text-center border-dashed"
  >
    <div
      class="w-20 h-20 bg-gradient-to-br from-primary-500/20 to-blue-500/20 dark:from-primary-500/10 dark:to-blue-500/10 rounded-3xl flex items-center justify-center mb-6 text-primary-500"
    >
      <i data-lucide="candlestick-chart" class="w-10 h-10"></i>
    </div>
    <h4 class="text-lg font-bold text-slate-700 dark:text-slate-300 mb-3">Bi·ªÉu ƒë·ªì k·ªπ thu·∫≠t</h4>
    <p class="text-sm text-slate-500 dark:text-slate-400 max-w-xs leading-relaxed">
      Xem bi·ªÉu ƒë·ªì gi√° v√† ph√¢n t√≠ch k·ªπ thu·∫≠t c·ªßa c·ªï phi·∫øu. H·ªó tr·ª£ m·ªü chart tr·ª±c ti·∫øp tr√™n TradingView ho·∫∑c Investing.com.
    </p>
    <div class="mt-6 px-4 py-2 bg-primary-50 dark:bg-primary-900/20 rounded-xl">
      <p class="text-xs text-primary-600 dark:text-primary-400 font-medium">
        üí° Click v√†o m√£ c·ªï phi·∫øu trong cu·ªôc tr√≤ chuy·ªán ƒë·ªÉ xem bi·ªÉu ƒë·ªì
      </p>
    </div>
  </div>
  <div id="chart-tab-content-container" class="animate-fade-in-up p-1 hidden h-full">
    <div id="chart-wrapper" class="w-full h-full flex flex-col gap-3 overflow-hidden">
      <!-- Chart Controls -->
      <div
        id="chart-control-container"
        class="flex flex-col gap-2 p-3 bg-white/30 dark:bg-slate-900/30 rounded-2xl border border-slate-200 dark:border-white/10 backdrop-blur-sm relative z-20"
      >
        <!-- Row 1: Time Controls + Indicator + Expand -->
        <div class="flex items-start justify-between gap-2">
          <div class="flex flex-wrap items-center gap-2 flex-1 min-w-0">
            <!-- Timeframe Selector -->
            <div class="flex items-center gap-1">
              <span class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase">Kho·∫£ng:</span>
              <select
                id="chart-timeframe"
                class="text-xs font-bold bg-white/60 dark:bg-slate-800/60 border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1 outline-none focus:ring-2 focus:ring-primary-500/30"
              >
                <option value="1D">1 Ng√†y</option>
                <option value="1W">1 Tu·∫ßn</option>
                <option value="1M">1 Th√°ng</option>
                <option value="3M">3 Th√°ng</option>
                <option value="6M" selected>6 Th√°ng</option>
                <option value="9M">9 Th√°ng</option>
                <option value="1Y">1 NƒÉm</option>
                <option value="2Y">2 NƒÉm</option>
                <option value="5Y">5 NƒÉm</option>
                <option value="10Y">10 NƒÉm</option>
              </select>
            </div>
            <!-- Interval Selector -->
            <div class="flex items-center gap-1">
              <span class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase">Chu k·ª≥:</span>
              <select
                id="chart-interval"
                class="text-xs font-bold bg-white/60 dark:bg-slate-800/60 border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1 outline-none focus:ring-2 focus:ring-primary-500/30"
              >
                <option value="5m">5 ph√∫t</option>
                <option value="15m">15 ph√∫t</option>
                <option value="30m">30 ph√∫t</option>
                <option value="1H">1 gi·ªù</option>
                <option value="1D" selected>1 ng√†y</option>
                <option value="1W">1 tu·∫ßn</option>
                <option value="1M">1 th√°ng</option>
              </select>
            </div>
            <!-- Indicator Dropdown -->
            <div class="relative" id="indicator-dropdown-container">
              <button
                id="indicator-dropdown-trigger"
                class="flex items-center gap-1.5 text-xs font-bold px-3 py-1.5 bg-white/60 dark:bg-slate-800/60 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-white/80 dark:hover:bg-slate-800/80 transition-colors"
              >
                <i data-lucide="line-chart" class="w-3.5 h-3.5"></i>
                <span>Ch·ªâ b√°o</span>
                <span
                  id="indicator-count-badge"
                  class="hidden min-w-[18px] h-[18px] px-1 bg-primary-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center"
                  >0</span
                >
                <i data-lucide="chevron-down" class="w-3 h-3 ml-0.5 transition-transform" id="indicator-chevron"></i>
              </button>

              <!-- Dropdown Panel -->
              <div
                id="indicator-dropdown-panel"
                class="hidden absolute top-full left-0 mt-2 w-72 max-h-[400px] overflow-y-auto p-3 bg-white/95 dark:bg-slate-900/95 backdrop-blur-xl border border-slate-200 dark:border-white/10 rounded-xl shadow-xl z-50"
              >
                <!-- Moving Averages Group -->
                <div class="mb-3">
                  <div
                    class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-2 px-1"
                  >
                    ƒê∆∞·ªùng trung b√¨nh
                  </div>
                  <div class="space-y-1">
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-ma"
                        class="w-4 h-4 rounded border-slate-300 accent-blue-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">SMA (20)</span>
                      <span class="text-[10px] text-slate-400 ml-auto">Simple MA</span>
                    </label>
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-ema"
                        class="w-4 h-4 rounded border-slate-300 accent-orange-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-orange-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">EMA (9)</span>
                      <span class="text-[10px] text-slate-400 ml-auto">Exponential MA</span>
                    </label>
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-wma"
                        class="w-4 h-4 rounded border-slate-300 accent-cyan-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-cyan-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">WMA (20)</span>
                      <span class="text-[10px] text-slate-400 ml-auto">Weighted MA</span>
                    </label>
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-vwap"
                        class="w-4 h-4 rounded border-slate-300 accent-violet-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-violet-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">VWAP</span>
                      <span class="text-[10px] text-slate-400 ml-auto">Vol Weighted Price</span>
                    </label>
                  </div>
                </div>

                <!-- Bands/Channels Group -->
                <div class="mb-3">
                  <div
                    class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-2 px-1"
                  >
                    D·∫£i gi√°
                  </div>
                  <div class="space-y-1">
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-bb"
                        class="w-4 h-4 rounded border-slate-300 accent-purple-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-purple-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">Bollinger Bands</span>
                      <span class="text-[10px] text-slate-400 ml-auto">BB (20,2)</span>
                    </label>
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-atr"
                        class="w-4 h-4 rounded border-slate-300 accent-pink-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-pink-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">ATR (14)</span>
                      <span class="text-[10px] text-slate-400 ml-auto">Avg True Range</span>
                    </label>
                  </div>
                </div>

                <!-- Oscillators Group -->
                <div class="mb-3">
                  <div
                    class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-2 px-1"
                  >
                    Dao ƒë·ªông
                  </div>
                  <div class="space-y-1">
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-rsi"
                        class="w-4 h-4 rounded border-slate-300 accent-amber-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-amber-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">RSI (14)</span>
                      <span class="text-[10px] text-slate-400 ml-auto">Relative Strength</span>
                    </label>
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-macd"
                        class="w-4 h-4 rounded border-slate-300 accent-blue-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">MACD</span>
                      <span class="text-[10px] text-slate-400 ml-auto">12, 26, 9</span>
                    </label>
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-stoch"
                        class="w-4 h-4 rounded border-slate-300 accent-emerald-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">Stochastic</span>
                      <span class="text-[10px] text-slate-400 ml-auto">%K, %D</span>
                    </label>
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-williams"
                        class="w-4 h-4 rounded border-slate-300 accent-cyan-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-cyan-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">Williams %R</span>
                      <span class="text-[10px] text-slate-400 ml-auto">14 periods</span>
                    </label>
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-cci"
                        class="w-4 h-4 rounded border-slate-300 accent-violet-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-violet-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">CCI (20)</span>
                      <span class="text-[10px] text-slate-400 ml-auto">Commodity Channel</span>
                    </label>
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-roc"
                        class="w-4 h-4 rounded border-slate-300 accent-orange-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-orange-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">ROC (10)</span>
                      <span class="text-[10px] text-slate-400 ml-auto">Rate of Change</span>
                    </label>
                  </div>
                </div>

                <!-- Trend Group -->
                <div class="mb-3">
                  <div
                    class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-2 px-1"
                  >
                    Xu h∆∞·ªõng
                  </div>
                  <div class="space-y-1">
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-adx"
                        class="w-4 h-4 rounded border-slate-300 accent-green-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-green-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">ADX (14)</span>
                      <span class="text-[10px] text-slate-400 ml-auto">+DI / -DI</span>
                    </label>
                  </div>
                </div>

                <!-- Volume Group -->
                <div>
                  <div
                    class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-2 px-1"
                  >
                    Kh·ªëi l∆∞·ª£ng
                  </div>
                  <div class="space-y-1">
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-vol-sma"
                        class="w-4 h-4 rounded border-slate-300 accent-violet-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-violet-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">Vol SMA (20)</span>
                      <span class="text-[10px] text-slate-400 ml-auto">Volume Average</span>
                    </label>
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-obv"
                        class="w-4 h-4 rounded border-slate-300 accent-cyan-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-cyan-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">OBV</span>
                      <span class="text-[10px] text-slate-400 ml-auto">On Balance Vol</span>
                    </label>
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-mfi"
                        class="w-4 h-4 rounded border-slate-300 accent-amber-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-amber-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">MFI (14)</span>
                      <span class="text-[10px] text-slate-400 ml-auto">Money Flow Index</span>
                    </label>
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-cmf"
                        class="w-4 h-4 rounded border-slate-300 accent-pink-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-pink-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">CMF (20)</span>
                      <span class="text-[10px] text-slate-400 ml-auto">Chaikin Money Flow</span>
                    </label>
                  </div>
                </div>

                <!-- Support/Resistance Group -->
                <div>
                  <div
                    class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase tracking-wider mb-2 px-1"
                  >
                    H·ªó tr·ª£/Kh√°ng c·ª±
                  </div>
                  <div class="space-y-1">
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-pivot"
                        class="w-4 h-4 rounded border-slate-300 accent-indigo-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-indigo-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">Pivot S/R</span>
                      <span class="text-[10px] text-slate-400 ml-auto">P, R1-R3, S1-S3</span>
                    </label>
                    <label
                      class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer group"
                    >
                      <input
                        type="checkbox"
                        id="indicator-fib"
                        class="w-4 h-4 rounded border-slate-300 accent-amber-500"
                      />
                      <span class="w-2 h-2 rounded-full bg-amber-500"></span>
                      <span class="text-xs font-medium text-slate-700 dark:text-slate-300">Fibonacci</span>
                      <span class="text-[10px] text-slate-400 ml-auto">0%-100% Retracement</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Expand Button (always top-right) -->
          <button
            id="chart-expand-btn"
            class="flex-shrink-0 flex items-center justify-center w-8 h-8 text-xs font-bold bg-white/60 dark:bg-slate-800/60 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-white/80 dark:hover:bg-slate-800/80 transition-all hover:scale-105"
            title="M·ªü r·ªông bi·ªÉu ƒë·ªì"
          >
            <i data-lucide="maximize-2" class="w-4 h-4" id="chart-expand-icon"></i>
          </button>
        </div>

        <!-- Row 2: Pattern Buttons with "M√¥ h√¨nh" label -->
        <div class="flex flex-wrap items-center gap-2">
          <span class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase">M√¥ h√¨nh:</span>
          <!-- Candlestick Patterns Dropdown -->
          <div class="relative" id="pattern-dropdown-container">
            <button
              id="pattern-dropdown-trigger"
              class="flex items-center gap-1.5 text-xs font-bold px-3 py-1.5 bg-white/60 dark:bg-slate-800/60 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-white/80 dark:hover:bg-slate-800/80 transition-colors"
            >
              <i data-lucide="scan-search" class="w-3.5 h-3.5"></i>
              <span>N·∫øn</span>
              <span
                id="pattern-count-badge"
                class="hidden min-w-[18px] h-[18px] px-1 bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center"
                >0</span
              >
              <i data-lucide="chevron-down" class="w-3 h-3 ml-0.5 transition-transform" id="pattern-chevron"></i>
            </button>

            <!-- Dropdown Panel -->
            <div
              id="pattern-dropdown-panel"
              class="hidden absolute top-full left-0 mt-2 w-80 max-h-[400px] overflow-y-auto p-3 bg-white/95 dark:bg-slate-900/95 backdrop-blur-xl border border-slate-200 dark:border-white/10 rounded-xl shadow-xl z-50 flex flex-col gap-2"
            >
              <div class="flex items-center justify-between mb-2">
                <span class="text-xs font-bold text-slate-500 uppercase flex-1">M√¥ h√¨nh n·∫øn</span>
                <button
                  id="scan-pattern-btn"
                  class="text-[10px] bg-primary-100 text-primary-600 px-2 py-1 rounded-md hover:bg-primary-200 transition-colors font-bold"
                >
                  Qu√©t l·∫°i
                </button>
              </div>
              <div id="pattern-list-container" class="flex flex-col gap-1 min-h-[100px]">
                <div class="flex items-center justify-center h-20 text-xs text-slate-400 italic">
                  Nh·∫•n "N·∫øn" ƒë·ªÉ qu√©t
                </div>
              </div>
            </div>
          </div>

          <!-- Chart Patterns Dropdown (Double Top, H&S, Triangles, etc.) -->
          <div class="relative" id="chart-pattern-dropdown-container">
            <button
              id="chart-pattern-dropdown-trigger"
              class="flex items-center gap-1.5 text-xs font-bold px-3 py-1.5 bg-white/60 dark:bg-slate-800/60 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-white/80 dark:hover:bg-slate-800/80 transition-colors"
            >
              <i data-lucide="triangle" class="w-3.5 h-3.5"></i>
              <span>Gi√°</span>
              <span
                id="chart-pattern-count-badge"
                class="hidden min-w-[18px] h-[18px] px-1 bg-blue-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center"
                >0</span
              >
              <i data-lucide="chevron-down" class="w-3 h-3 ml-0.5 transition-transform"></i>
            </button>

            <!-- Dropdown Panel -->
            <div
              id="chart-pattern-dropdown-panel"
              class="hidden absolute top-full left-0 mt-2 w-80 max-h-[400px] overflow-y-auto p-3 bg-white/95 dark:bg-slate-900/95 backdrop-blur-xl border border-slate-200 dark:border-white/10 rounded-xl shadow-xl z-50 flex flex-col gap-2"
            >
              <div class="flex items-center justify-between mb-2">
                <span class="text-xs font-bold text-slate-500 uppercase flex-1">M√¥ h√¨nh gi√°</span>
                <button
                  class="text-[10px] bg-blue-100 text-blue-600 px-2 py-1 rounded-md hover:bg-blue-200 transition-colors font-bold"
                  onclick="if (currentChartSymbol) fetchChartPatterns(currentChartSymbol);"
                >
                  Qu√©t l·∫°i
                </button>
              </div>
              <div id="chart-pattern-list-container" class="flex flex-col gap-1 min-h-[100px]">
                <div class="flex items-center justify-center h-20 text-xs text-slate-400 italic">
                  Nh·∫•n "Gi√°" ƒë·ªÉ qu√©t
                </div>
              </div>
            </div>
          </div>

          <!-- Support/Resistance Zones Dropdown -->
          <div class="relative" id="sr-zone-dropdown-container">
            <button
              id="sr-zone-dropdown-trigger"
              class="flex items-center gap-1.5 text-xs font-bold px-3 py-1.5 bg-white/60 dark:bg-slate-800/60 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-white/80 dark:hover:bg-slate-800/80 transition-colors"
            >
              <i data-lucide="git-commit-horizontal" class="w-3.5 h-3.5"></i>
              <span>S/R</span>
              <i data-lucide="chevron-down" class="w-3 h-3 ml-0.5 transition-transform"></i>
            </button>

            <!-- Dropdown Panel -->
            <div
              id="sr-zone-dropdown-panel"
              class="hidden absolute top-full left-0 mt-2 w-72 max-h-[400px] overflow-y-auto p-3 bg-white/95 dark:bg-slate-900/95 backdrop-blur-xl border border-slate-200 dark:border-white/10 rounded-xl shadow-xl z-50 flex flex-col gap-2"
            >
              <div class="flex items-center justify-between mb-2">
                <span class="text-xs font-bold text-slate-500 uppercase flex-1">V√πng h·ªó tr·ª£/Kh√°ng c·ª±</span>
                <button
                  class="text-[10px] bg-green-100 text-green-600 px-2 py-1 rounded-md hover:bg-green-200 transition-colors font-bold"
                  onclick="if (currentChartSymbol) fetchSupportResistance(currentChartSymbol);"
                >
                  Qu√©t l·∫°i
                </button>
              </div>
              <div id="sr-zone-list-container" class="flex flex-col gap-1 min-h-[100px]">
                <div class="flex items-center justify-center h-20 text-xs text-slate-400 italic">
                  Nh·∫•n "S/R" ƒë·ªÉ qu√©t
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Combined Chart with Panes (Price + Volume) -->
      <div
        id="chart-container-wrapper"
        class="flex-1 bg-white/40 dark:bg-slate-900/40 rounded-2xl border border-slate-200 dark:border-white/10 backdrop-blur-sm p-3 min-h-0"
      >
        <div id="chart-container" style="width: 100%; height: 100%"></div>
      </div>
    </div>
  </div>
</div>

<!-- Chart Error Template -->
<template id="chart-error-template">
  <div class="flex flex-col items-center justify-center h-full text-center p-6">
    <i data-lucide="alert-circle" class="w-12 h-12 text-amber-500 mb-4"></i>
    <p class="text-slate-600 dark:text-slate-400 mb-4">
      Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu bi·ªÉu ƒë·ªì cho <strong class="chart-error-symbol"></strong>
    </p>
    <p class="text-sm text-slate-500 dark:text-slate-500 mb-6">
      Vui l√≤ng s·ª≠ d·ª•ng c√°c n·ªÅn t·∫£ng b√™n d∆∞·ªõi ƒë·ªÉ xem bi·ªÉu ƒë·ªì:
    </p>
    <div class="flex gap-3">
      <a
        href="#"
        class="chart-error-tradingview flex items-center gap-1.5 px-3 py-2 bg-gradient-to-r from-[#2962FF]/60 to-[#1E88E5]/60 dark:from-[#2962FF]/90 dark:to-[#1E88E5]/90 hover:from-[#2962FF] hover:to-[#1E88E5] backdrop-blur-xl backdrop-saturate-150 text-white text-xs font-bold rounded-xl transition-all shadow-lg shadow-blue-500/20 dark:shadow-blue-500/30 border border-white/30 dark:border-white/10 ring-1 ring-inset ring-white/10 hover:shadow-xl hover:scale-105"
        target="_blank"
        rel="noreferrer noopener"
      >
        <svg class="w-4 h-4" viewBox="0 0 36 28" fill="currentColor">
          <path d="M14 22H7V6h7v16zm8-16h-7v16h7V6zm8 16h-7V6h7v16z" />
        </svg>
        TradingView
      </a>
      <a
        href="#"
        class="chart-error-investing flex items-center gap-1.5 px-3 py-2 bg-gradient-to-r from-[#EF6C35]/60 to-[#FF8A50]/60 dark:from-[#EF6C35]/90 dark:to-[#FF8A50]/90 hover:from-[#EF6C35] hover:to-[#FF8A50] backdrop-blur-xl backdrop-saturate-150 text-white text-xs font-bold rounded-xl transition-all shadow-lg shadow-orange-500/20 dark:shadow-orange-500/30 border border-white/30 dark:border-white/10 ring-1 ring-inset ring-white/10 hover:shadow-xl hover:scale-105"
        target="_blank"
        rel="noreferrer noopener"
      >
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
          <path d="M3 3v18h18V3H3zm16 16H5V5h14v14zM7 7v10h2V7H7zm4 4v6h2v-6h-2zm4-2v8h2V9h-2z" />
        </svg>
        Investing
      </a>
    </div>
  </div>
</template>

<!-- Chart Skeleton Template -->
<template id="chart-skeleton-template">
  <div class="h-full w-full flex flex-col gap-2 p-2 chart-skeleton">
    <div class="flex-1 flex items-end gap-1 chart-skeleton-bars"></div>
    <div class="h-2 inset-0 bg-slate-200/50 dark:bg-slate-800/40 skeleton-shimmer rounded-lg w-full"></div>
  </div>
</template>

<!-- Loading Spinner Template -->
<template id="loading-spinner-template">
  <div class="flex items-center justify-center p-4">
    <div class="w-5 h-5 border-2 border-primary-500 border-t-transparent rounded-full animate-spin"></div>
  </div>
</template>

<!-- Text Error Message Template -->
<template id="text-error-template">
  <div class="text-xs text-red-500 p-2 text-center"></div>
</template>

<!-- Text Info Message Template -->
<template id="text-info-template">
  <div class="text-xs text-slate-500 p-2 text-center"></div>
</template>

<!-- Pattern Item Template -->
<template id="pattern-item-template">
  <div
    class="pattern-item flex items-center justify-between p-2 rounded hover:bg-slate-100 dark:hover:bg-slate-800 cursor-pointer border border-transparent hover:border-slate-200 dark:hover:border-slate-700 transition-all"
  >
    <div class="flex flex-col gap-0.5">
      <div class="flex items-center gap-1.5 font-bold text-xs text-slate-700 dark:text-slate-200">
        <span class="pattern-name"></span>
        <span class="pattern-signal text-[10px] px-1.5 py-0.5 rounded-full"></span>
      </div>
      <div class="pattern-date text-[10px] text-slate-400"></div>
    </div>
    <div class="flex items-center gap-2">
      <div class="pattern-price text-xs font-bold"></div>
      <i data-lucide="check" class="pattern-check w-4 h-4 text-green-500 hidden"></i>
    </div>
  </div>
</template>

<!-- Chart Pattern Item Template -->
<template id="chart-pattern-item-template">
  <div
    class="chart-pattern-item p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-colors border border-transparent"
  >
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-2">
        <span class="chart-pattern-name font-medium text-sm"></span>
        <span class="chart-pattern-signal text-xs px-1.5 py-0.5 rounded"></span>
        <i data-lucide="check" class="pattern-check w-4 h-4 text-green-500 hidden"></i>
      </div>
      <span class="chart-pattern-confidence text-xs text-gray-500 dark:text-gray-400"></span>
    </div>
    <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1 gap-2">
      <span class="chart-pattern-date-range"></span>
      <span class="chart-pattern-target whitespace-nowrap"></span>
    </div>
  </div>
</template>

<!-- S/R Zone Item Template -->
<template id="sr-zone-item-template">
  <div
    class="sr-zone-item p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-colors border border-transparent"
  >
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-2">
        <span class="sr-zone-price font-medium text-sm"></span>
        <span class="sr-zone-strength text-xs px-1.5 py-0.5 rounded bg-gray-100 dark:bg-gray-700"></span>
        <i data-lucide="check" class="sr-check w-4 h-4 text-green-500 hidden"></i>
      </div>
      <span class="sr-zone-distance text-xs text-gray-500 dark:text-gray-400"></span>
    </div>
    <div class="sr-zone-range text-xs text-gray-500 dark:text-gray-400 mt-0.5"></div>
  </div>
</template>
